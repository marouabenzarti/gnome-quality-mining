#!/usr/bin/env python
# encoding: utf-8
"""
query_corpora.py
Created by Neil Ernst on 2009-02-06.
"""

import sys
import getopt
import datetime
from MySQLdb.cursors import DictCursor,SSDictCursor
import MySQLdb
from names import Taxonomy

def connect_corpus(db_name):
    """ connect to db"""
    storedb = MySQLdb.connect(user='root',  db=db_name, cursorclass=DictCursor)
    store_cursor = storedb.cursor()
    return store_cursor
    
def get_counts(keyword, product):  #, q, year):
    """ store in the database"""
    db_name = 'data_objects'
    store_cursor = connect_corpus(db_name)

    query_string = """SELECT yearweek(msr_date), COUNT(*) FROM t_data WHERE product = \'%(product)s\' 
                        AND MATCH(event) AGAINST (\'%(key)s\' in boolean mode) GROUP BY yearweek(msr_date)
                        UNION ALL 
                        SELECT yearweek(msr_date), COUNT(*) FROM data WHERE product = \'%(product)s\' 
                        AND MATCH(event) AGAINST (\'%(key)s\' in boolean mode)
                        GROUP BY yearweek(msr_date) ASC """ % {"key":keyword, "product":product}

    #this query determines total events overall (to normalize against)    
    #note, union all produces two sets of rows! must aggregate the numbers.                            
    totals_query = """SELECT yearweek(msr_date), COUNT(*) FROM t_data WHERE product = \'%(product)s\' GROUP BY yearweek(msr_date)
                        UNION ALL 
                      select yearweek(msr_date), count(*) from data WHERE product = \'%(product)s\' 
                      group by yearweek(msr_date) ASC """ % {"product":product}
    try:
        store_cursor.execute(query_string)
        key_num = store_cursor.fetchall()
        key_num = create_dict(key_num) #create a dict with date-week as key, count as values
        store_cursor.execute(totals_query)
        total_val = store_cursor.fetchall()
        total_num = create_dict(total_val)
        print key_num, total_num
        return key_num, total_num #two tuples
    except (ValueError):
        print 'Error in query syntax'
        
def create_dict(key_dict):
    res_list = []
    for x in key_dict:
        dw = x.values()[0]
        cnt = x.values()[1]
        rdict = {dw: cnt}
        res_list.append(rdict)
    return res_list
    
def query_database(product, signifiers):
    """Sends the query"""
    result_lst = []
    signifier_list = ''
    for signifier in signifiers:
        signifier_list = signifier + ' ' + signifier_list
    
    print "Getting counts for: " + signifier_list, product
    result, total = get_counts(signifier_list, product)#, quarter, year)
    return normalize(result, total)

def normalize(result, total):
    """Takes a dictionary with absolute counts and a dictionary with message frequency.
    Returns a tuple with the dateweek, absolute value, and normalized value"""
    normal_multiplier = 1000 #set appropriately to get results between 0 and 1000
    #Mysql yearweek() function has default mode of 0, weeks start Sunday and week 1 is first week with sunday in the year.
    complete_year_weeks = []
    years = [199800,199900,200000,200100,200200,200300,200400,200500,200600,200700,200800]
    weeks = [i for i in range(0,54)]
    for y in years:
        for w in weeks:
             complete_year_weeks.append(y+w)
    
    #there are duplicate keys!
    result_dict = {}
    for r in result:
         k = r.keys()
         v = r.values()
         if k[0] in result_dict.keys():
            result_dict[k[0]] = result_dict[k[0]] + v[0] #previous value
            print str(k[0]) + ' was a dupe'
         else:        
             result_dict[k[0]] = v[0]
    print result_dict[200136] 
    total_dict = {}
    for t in total:
         k = t.keys()
         v = t.values()
         if k[0] in total_dict.keys():
             total_dict[k[0]] = total_dict[k[0]] + v[0] #previous value
             #print str(k[0]) + ' was a dupe'
         else:
             total_dict[k[0]] = v[0]
    # for each element in total
    result_lst = []
    save = False # determine if there is *any* data to save
    for c in complete_year_weeks:
        try:
            res_value = result_dict[c]  # find that year week in result
            save = True #omit leading zero results
        except(KeyError):
            res_value = 0
        try:
            total_value = total_dict[c] 
        except(KeyError):
            total_value = 0 #there was no value for that year
        normal = 0.0
        if total_value != 0:
            normal = normal_multiplier*float(res_value)/float(total_value)        
        res_tuple = (c, normal, res_value) # e.g., (200803, 3.3, 55)
        if save:
            result_lst.append(res_tuple)
    
    return result_lst
         
    
def main():
    t = Taxonomy()     
    #result = query_database('Nautilus', t.get_signifiers('Portability'))
    result = [{200136L: 156L}, {200138L: 2L}, {200139L: 1L}, {200140L: 1L}, {200142L: 3L}, {200144L: 2L}, {200145L: 1L}, {200149L: 2L}, {200151L: 1L}, {200203L: 2L}, {200204L: 1L}, {200205L: 1L}, {200206L: 2L}, {200207L: 2L}, {200209L: 2L}, {200210L: 1L}, {200211L: 1L}, {200216L: 1L}, {200217L: 1L}, {200218L: 1L}, {200219L: 1L}, {200221L: 1L}, {200222L: 3L}, {200223L: 1L}, {200224L: 12L}, {200225L: 1L}, {200226L: 2L}, {200227L: 2L}, {200228L: 2L}, {200230L: 2L}, {200231L: 3L}, {200232L: 1L}, {200233L: 1L}, {200235L: 1L}, {200236L: 2L}, {200237L: 1L}, {200239L: 2L}, {200240L: 2L}, {200241L: 2L}, {200242L: 2L}, {200243L: 2L}, {200246L: 1L}, {200247L: 1L}, {200248L: 3L}, {200250L: 1L}, {200251L: 3L}, {200252L: 1L}, {200301L: 1L}, {200302L: 1L}, {200304L: 2L}, {200306L: 1L}, {200307L: 2L}, {200312L: 1L}, {200313L: 1L}, {200315L: 1L}, {200316L: 1L}, {200319L: 1L}, {200322L: 4L}, {200323L: 1L}, {200326L: 1L}, {200327L: 1L}, {200329L: 1L}, {200330L: 1L}, {200332L: 2L}, {200334L: 1L}, {200337L: 3L}, {200341L: 1L}, {200342L: 1L}, {200345L: 2L}, {200348L: 1L}, {200351L: 1L}, {200402L: 1L}, {200404L: 11L}, {200406L: 2L}, {200407L: 1L}, {200408L: 1L}, {200410L: 2L}, {200412L: 2L}, {200414L: 1L}, {200417L: 2L}, {200419L: 1L}, {200420L: 2L}, {200421L: 2L}, {200422L: 1L}, {200423L: 1L}, {200424L: 1L}, {200426L: 5L}, {200427L: 3L}, {200428L: 1L}, {200429L: 1L}, {200434L: 2L}, {200435L: 1L}, {200436L: 1L}, {200438L: 1L}, {200441L: 1L}, {200442L: 1L}, {200501L: 3L}, {200502L: 2L}, {200504L: 1L}, {200506L: 1L}, {200507L: 2L}, {200508L: 2L}, {200511L: 1L}, {200512L: 3L}, {200519L: 2L}, {200520L: 4L}, {200522L: 1L}, {200523L: 1L}, {200525L: 1L}, {200528L: 1L}, {200529L: 1L}, {200531L: 2L}, {200534L: 5L}, {200537L: 1L}, {200538L: 2L}, {200540L: 1L}, {200543L: 3L}, {200548L: 1L}, {200550L: 1L}, {200601L: 2L}, {200602L: 3L}, {200603L: 3L}, {200605L: 2L}, {200607L: 3L}, {200608L: 3L}, {200609L: 1L}, {200611L: 4L}, {200612L: 2L}, {200613L: 1L}, {200614L: 1L}, {200618L: 1L}, {200620L: 2L}, {200621L: 1L}, {200627L: 1L}, {200628L: 1L}, {200630L: 2L}, {200637L: 1L}, {200640L: 2L}, {200642L: 1L}, {200643L: 1L}, {200644L: 1L}, {200646L: 2L}, {200647L: 1L}, {200648L: 1L}, {200650L: 1L}, {200651L: 1L}, {200653L: 1L}, {200701L: 1L}, {200702L: 2L}, {200704L: 1L}, {200706L: 1L}, {200707L: 2L}, {200711L: 2L}, {200716L: 1L}, {200718L: 1L}, {200722L: 1L}, {200724L: 1L}, {200725L: 1L}, {200726L: 1L}, {200728L: 1L}, {200729L: 1L}, {200730L: 2L}, {200731L: 1L}, {200738L: 1L}, {200739L: 2L}, {200740L: 2L}, {200742L: 1L}, {200744L: 3L}, {200745L: 1L}, {200747L: 1L}, {200750L: 1L}, {200801L: 1L}, {200802L: 2L}, {200803L: 1L}, {200804L: 2L}, {200805L: 1L}, {200806L: 3L}, {200807L: 1L}, {200808L: 4L}, {200811L: 1L}, {200813L: 2L}, {200815L: 2L}, {200817L: 3L}, {200818L: 4L}, {200819L: 1L}, {200820L: 1L}, {200822L: 2L}, {200823L: 1L}, {200824L: 2L}, {200825L: 4L}, {200829L: 2L}, {200831L: 1L}, {200832L: 3L}, {200833L: 2L}, {200834L: 2L}, {200835L: 5L}, {200836L: 2L}, {197905L: 1L}, {199949L: 1L}, {200002L: 1L}, {200015L: 2L}, {200016L: 4L}, {200018L: 3L}, {200019L: 5L}, {200021L: 1L}, {200022L: 2L}, {200023L: 1L}, {200025L: 2L}, {200029L: 1L}, {200030L: 5L}, {200031L: 1L}, {200033L: 1L}, {200034L: 1L}, {200035L: 3L}, {200036L: 2L}, {200037L: 2L}, {200038L: 3L}, {200040L: 5L}, {200041L: 3L}, {200042L: 6L}, {200043L: 3L}, {200045L: 2L}, {200046L: 2L}, {200047L: 2L}, {200048L: 2L}, {200049L: 2L}, {200050L: 5L}, {200051L: 2L}, {200052L: 1L}, {200053L: 8L}, {200101L: 2L}, {200102L: 2L}, {200103L: 4L}, {200104L: 3L}, {200105L: 1L}, {200106L: 2L}, {200107L: 6L}, {200108L: 10L}, {200109L: 6L}, {200111L: 3L}, {200112L: 2L}, {200113L: 8L}, {200114L: 2L}, {200116L: 4L}, {200118L: 4L}, {200119L: 1L}, {200121L: 1L}, {200122L: 4L}, {200123L: 10L}, {200126L: 6L}, {200130L: 3L}, {200131L: 6L}, {200132L: 18L}, {200133L: 16L}, {200134L: 3L}, {200135L: 7L}, {200138L: 2L}, {200139L: 2L}, {200143L: 5L}, {200144L: 2L}, {200145L: 2L}, {200146L: 1L}, {200147L: 4L}, {200148L: 5L}, {200149L: 4L}, {200150L: 1L}, {200152L: 2L}, {200201L: 2L}, {200203L: 1L}, {200204L: 1L}, {200205L: 9L}, {200206L: 1L}, {200207L: 2L}, {200208L: 2L}, {200209L: 2L}, {200210L: 4L}, {200211L: 7L}, {200213L: 8L}, {200214L: 2L}, {200215L: 3L}, {200216L: 2L}, {200217L: 10L}, {200218L: 2L}, {200219L: 3L}, {200220L: 5L}, {200221L: 10L}, {200222L: 4L}, {200223L: 3L}, {200224L: 14L}, {200225L: 9L}, {200226L: 5L}, {200227L: 5L}, {200228L: 7L}, {200230L: 6L}, {200231L: 7L}, {200232L: 1L}, {200233L: 3L}, {200234L: 5L}, {200235L: 6L}, {200236L: 2L}, {200237L: 1L}, {200239L: 2L}, {200240L: 2L}, {200241L: 4L}, {200242L: 4L}, {200243L: 4L}, {200244L: 2L}, {200245L: 3L}, {200246L: 2L}, {200247L: 5L}, {200248L: 5L}, {200250L: 1L}, {200251L: 3L}, {200252L: 1L}, {200301L: 2L}, {200302L: 1L}, {200303L: 3L}, {200304L: 2L}, {200305L: 3L}, {200306L: 8L}, {200307L: 4L}, {200308L: 5L}, {200309L: 1L}, {200310L: 1L}, {200311L: 3L}, {200312L: 2L}, {200313L: 3L}, {200315L: 1L}, {200316L: 1L}, {200318L: 1L}, {200319L: 7L}, {200320L: 5L}, {200321L: 1L}, {200322L: 4L}, {200323L: 1L}, {200324L: 3L}, {200325L: 2L}, {200326L: 12L}, {200327L: 5L}, {200328L: 4L}, {200329L: 2L}, {200330L: 2L}, {200331L: 5L}, {200332L: 4L}, {200333L: 1L}, {200334L: 1L}, {200335L: 2L}, {200337L: 8L}, {200338L: 4L}, {200341L: 5L}, {200342L: 5L}, {200345L: 5L}, {200347L: 1L}, {200348L: 4L}, {200349L: 5L}, {200350L: 3L}, {200351L: 4L}, {200401L: 3L}, {200402L: 4L}, {200403L: 4L}, {200404L: 13L}, {200405L: 7L}, {200406L: 2L}, {200407L: 3L}, {200408L: 1L}, {200409L: 2L}, {200410L: 5L}, {200412L: 2L}, {200413L: 2L}, {200414L: 3L}, {200416L: 1L}, {200417L: 3L}, {200418L: 1L}, {200419L: 4L}, {200420L: 5L}, {200421L: 3L}, {200422L: 2L}, {200423L: 1L}, {200424L: 1L}, {200425L: 2L}, {200426L: 5L}, {200427L: 3L}, {200428L: 2L}, {200429L: 1L}, {200430L: 1L}, {200431L: 5L}, {200434L: 2L}, {200435L: 3L}, {200436L: 1L}, {200437L: 1L}, {200438L: 3L}, {200440L: 2L}, {200441L: 1L}, {200442L: 4L}, {200443L: 1L}, {200449L: 3L}, {200450L: 2L}, {200501L: 3L}, {200502L: 2L}, {200503L: 1L}, {200504L: 3L}, {200505L: 1L}, {200506L: 1L}, {200507L: 5L}, {200508L: 5L}, {200511L: 1L}, {200512L: 2L}, {200514L: 4L}, {200515L: 1L}, {200519L: 4L}, {200520L: 4L}, {200521L: 2L}, {200522L: 1L}, {200523L: 1L}, {200524L: 5L}, {200525L: 2L}, {200527L: 1L}, {200528L: 3L}, {200529L: 4L}, {200531L: 4L}, {200532L: 2L}, {200533L: 2L}, {200534L: 5L}, {200535L: 2L}, {200537L: 1L}, {200538L: 2L}, {200539L: 1L}, {200540L: 1L}, {200543L: 3L}, {200546L: 2L}, {200548L: 1L}, {200549L: 1L}, {200550L: 2L}, {200601L: 2L}, {200602L: 3L}, {200603L: 3L}, {200605L: 2L}, {200606L: 4L}, {200607L: 3L}, {200608L: 3L}, {200609L: 4L}, {200611L: 8L}, {200612L: 3L}, {200613L: 4L}, {200614L: 4L}, {200618L: 1L}, {200619L: 1L}, {200620L: 4L}, {200621L: 1L}, {200627L: 1L}, {200628L: 3L}, {200630L: 3L}, {200634L: 4L}, {200636L: 3L}, {200637L: 3L}, {200638L: 1L}, {200639L: 1L}, {200640L: 3L}, {200642L: 6L}, {200643L: 1L}, {200644L: 2L}, {200646L: 3L}, {200647L: 5L}, {200648L: 1L}, {200650L: 2L}, {200651L: 2L}, {200653L: 1L}, {200701L: 4L}, {200702L: 5L}, {200704L: 1L}, {200706L: 1L}, {200707L: 2L}, {200709L: 3L}, {200711L: 3L}, {200714L: 1L}, {200715L: 1L}, {200716L: 7L}, {200718L: 1L}, {200719L: 1L}, {200722L: 1L}, {200723L: 1L}, {200724L: 2L}, {200725L: 1L}, {200726L: 1L}, {200728L: 1L}, {200729L: 2L}, {200730L: 2L}, {200731L: 4L}, {200739L: 2L}, {200740L: 2L}, {200742L: 1L}, {200744L: 3L}, {200745L: 1L}, {200747L: 1L}, {200748L: 1L}, {200750L: 1L}, {200801L: 3L}, {200802L: 2L}, {200803L: 1L}, {200804L: 5L}, {200805L: 3L}, {200806L: 1L}, {200807L: 7L}, {200808L: 7L}, {200809L: 4L}, {200810L: 1L}, {200811L: 3L}, {200813L: 2L}, {200815L: 1L}, {200817L: 1L}, {200818L: 3L}, {200820L: 1L}, {200822L: 1L}, {200823L: 1L}, {200824L: 6L}, {200825L: 2L}, {200829L: 1L}, {200832L: 1L}, {200833L: 2L}, {200835L: 5L}, {200836L: 1L}]
    total = [{189953L: 33L}, {200107L: 6L}, {200108L: 4L}, {200109L: 1L}, {200110L: 3L}, {200111L: 1L}, {200112L: 1L}, {200113L: 2L}, {200114L: 1L}, {200115L: 1L}, {200116L: 11L}, {200117L: 8L}, {200118L: 8L}, {200119L: 5L}, {200120L: 24L}, {200121L: 8L}, {200122L: 3L}, {200123L: 6L}, {200124L: 5L}, {200125L: 1L}, {200126L: 1L}, {200127L: 2L}, {200128L: 2L}, {200129L: 2L}, {200130L: 3L}, {200131L: 5L}, {200132L: 1L}, {200133L: 10L}, {200134L: 7L}, {200135L: 6L}, {200136L: 7546L}, {200137L: 96L}, {200138L: 93L}, {200139L: 76L}, {200140L: 175L}, {200141L: 101L}, {200142L: 146L}, {200143L: 184L}, {200144L: 95L}, {200145L: 88L}, {200146L: 63L}, {200147L: 78L}, {200148L: 117L}, {200149L: 79L}, {200150L: 63L}, {200151L: 26L}, {200152L: 1219L}, {200201L: 94L}, {200202L: 80L}, {200203L: 276L}, {200204L: 120L}, {200205L: 174L}, {200206L: 152L}, {200207L: 245L}, {200208L: 429L}, {200209L: 449L}, {200210L: 472L}, {200211L: 324L}, {200212L: 184L}, {200213L: 156L}, {200214L: 104L}, {200215L: 262L}, {200216L: 254L}, {200217L: 80L}, {200218L: 168L}, {200219L: 191L}, {200220L: 174L}, {200221L: 215L}, {200222L: 369L}, {200223L: 306L}, {200224L: 412L}, {200225L: 277L}, {200226L: 224L}, {200227L: 210L}, {200228L: 199L}, {200229L: 189L}, {200230L: 256L}, {200231L: 246L}, {200232L: 200L}, {200233L: 174L}, {200234L: 141L}, {200235L: 154L}, {200236L: 134L}, {200237L: 117L}, {200238L: 92L}, {200239L: 88L}, {200240L: 150L}, {200241L: 162L}, {200242L: 247L}, {200243L: 393L}, {200244L: 472L}, {200245L: 287L}, {200246L: 265L}, {200247L: 229L}, {200248L: 183L}, {200249L: 150L}, {200250L: 113L}, {200251L: 113L}, {200252L: 228L}, {200301L: 276L}, {200302L: 285L}, {200303L: 262L}, {200304L: 146L}, {200305L: 182L}, {200306L: 156L}, {200307L: 152L}, {200308L: 130L}, {200309L: 126L}, {200310L: 144L}, {200311L: 169L}, {200312L: 113L}, {200313L: 139L}, {200314L: 131L}, {200315L: 112L}, {200316L: 188L}, {200317L: 147L}, {200318L: 130L}, {200319L: 100L}, {200320L: 70L}, {200321L: 89L}, {200322L: 80L}, {200323L: 191L}, {200324L: 64L}, {200325L: 125L}, {200326L: 165L}, {200327L: 129L}, {200328L: 110L}, {200329L: 93L}, {200330L: 110L}, {200331L: 135L}, {200332L: 146L}, {200333L: 95L}, {200334L: 143L}, {200335L: 109L}, {200336L: 80L}, {200337L: 200L}, {200338L: 245L}, {200339L: 198L}, {200340L: 121L}, {200341L: 211L}, {200342L: 131L}, {200343L: 298L}, {200344L: 126L}, {200345L: 216L}, {200346L: 223L}, {200347L: 438L}, {200348L: 202L}, {200349L: 238L}, {200350L: 128L}, {200351L: 180L}, {200352L: 191L}, {200401L: 242L}, {200402L: 223L}, {200403L: 230L}, {200404L: 220L}, {200405L: 191L}, {200406L: 338L}, {200407L: 332L}, {200408L: 184L}, {200409L: 233L}, {200410L: 166L}, {200411L: 125L}, {200412L: 304L}, {200413L: 190L}, {200414L: 258L}, {200415L: 297L}, {200416L: 225L}, {200417L: 148L}, {200418L: 267L}, {200419L: 181L}, {200420L: 162L}, {200421L: 108L}, {200422L: 110L}, {200423L: 101L}, {200424L: 71L}, {200425L: 64L}, {200426L: 92L}, {200427L: 650L}, {200428L: 114L}, {200429L: 233L}, {200430L: 170L}, {200431L: 202L}, {200432L: 165L}, {200433L: 183L}, {200434L: 186L}, {200435L: 154L}, {200436L: 200L}, {200437L: 484L}, {200438L: 156L}, {200439L: 227L}, {200440L: 192L}, {200441L: 122L}, {200442L: 401L}, {200443L: 233L}, {200444L: 319L}, {200445L: 150L}, {200446L: 170L}, {200447L: 163L}, {200448L: 172L}, {200449L: 172L}, {200450L: 138L}, {200451L: 155L}, {200452L: 125L}, {200501L: 434L}, {200502L: 261L}, {200503L: 256L}, {200504L: 401L}, {200505L: 517L}, {200506L: 356L}, {200507L: 231L}, {200508L: 238L}, {200509L: 265L}, {200510L: 203L}, {200511L: 239L}, {200512L: 192L}, {200513L: 202L}, {200514L: 216L}, {200515L: 230L}, {200516L: 174L}, {200517L: 203L}, {200518L: 269L}, {200519L: 522L}, {200520L: 447L}, {200521L: 370L}, {200522L: 282L}, {200523L: 332L}, {200524L: 192L}, {200525L: 242L}, {200526L: 77L}, {200527L: 145L}, {200528L: 500L}, {200529L: 256L}, {200530L: 296L}, {200531L: 302L}, {200532L: 176L}, {200533L: 161L}, {200534L: 267L}, {200535L: 297L}, {200536L: 216L}, {200537L: 225L}, {200538L: 100L}, {200539L: 186L}, {200540L: 198L}, {200541L: 154L}, {200542L: 80L}, {200543L: 100L}, {200544L: 99L}, {200545L: 145L}, {200546L: 207L}, {200547L: 85L}, {200548L: 182L}, {200549L: 83L}, {200550L: 122L}, {200551L: 238L}, {200552L: 456L}, {200601L: 149L}, {200602L: 193L}, {200603L: 105L}, {200604L: 118L}, {200605L: 164L}, {200606L: 145L}, {200607L: 154L}, {200608L: 167L}, {200609L: 177L}, {200610L: 119L}, {200611L: 183L}, {200612L: 208L}, {200613L: 135L}, {200614L: 194L}, {200615L: 134L}, {200616L: 116L}, {200617L: 155L}, {200618L: 129L}, {200619L: 123L}, {200620L: 150L}, {200621L: 116L}, {200622L: 103L}, {200623L: 85L}, {200624L: 102L}, {200625L: 98L}, {200626L: 138L}, {200627L: 129L}, {200628L: 81L}, {200629L: 126L}, {200630L: 160L}, {200631L: 134L}, {200632L: 169L}, {200633L: 166L}, {200634L: 121L}, {200635L: 159L}, {200636L: 200L}, {200637L: 240L}, {200638L: 239L}, {200639L: 282L}, {200640L: 471L}, {200641L: 472L}, {200642L: 738L}, {200643L: 1358L}, {200644L: 2582L}, {200645L: 1307L}, {200646L: 1334L}, {200647L: 960L}, {200648L: 1061L}, {200649L: 1046L}, {200650L: 1284L}, {200651L: 1140L}, {200652L: 1191L}, {200653L: 1236L}, {200701L: 947L}, {200702L: 1225L}, {200703L: 988L}, {200704L: 820L}, {200705L: 1355L}, {200706L: 1053L}, {200707L: 1267L}, {200708L: 996L}, {200709L: 1270L}, {200710L: 1120L}, {200711L: 1077L}, {200712L: 1213L}, {200713L: 906L}, {200714L: 1039L}, {200715L: 881L}, {200716L: 975L}, {200717L: 525L}, {200718L: 557L}, {200719L: 562L}, {200720L: 691L}, {200721L: 547L}, {200722L: 577L}, {200723L: 530L}, {200724L: 1281L}, {200725L: 1518L}, {200726L: 788L}, {200727L: 335L}, {200728L: 616L}, {200729L: 1038L}, {200730L: 686L}, {200731L: 772L}, {200732L: 369L}, {200733L: 724L}, {200734L: 291L}, {200735L: 656L}, {200736L: 940L}, {200737L: 425L}, {200738L: 630L}, {200739L: 1013L}, {200740L: 653L}, {200741L: 905L}, {200742L: 793L}, {200743L: 697L}, {200744L: 1595L}, {200745L: 1468L}, {200746L: 900L}, {200747L: 486L}, {200748L: 468L}, {200749L: 317L}, {200750L: 452L}, {200751L: 951L}, {200752L: 668L}, {200801L: 722L}, {200802L: 826L}, {200803L: 846L}, {200804L: 565L}, {200805L: 528L}, {200806L: 462L}, {200807L: 422L}, {200808L: 458L}, {200809L: 394L}, {200810L: 471L}, {200811L: 470L}, {200812L: 525L}, {200813L: 845L}, {200814L: 670L}, {200815L: 708L}, {200816L: 554L}, {200817L: 638L}, {200818L: 624L}, {200819L: 643L}, {200820L: 651L}, {200821L: 605L}, {200822L: 515L}, {200823L: 645L}, {200824L: 530L}, {200825L: 529L}, {200826L: 552L}, {200827L: 452L}, {200828L: 452L}, {200829L: 486L}, {200830L: 446L}, {200831L: 270L}, {200832L: 176L}, {200833L: 255L}, {200834L: 265L}, {200835L: 298L}, {200836L: 228L}, {200837L: 106L}, {189953L: 24L}, {197905L: 7L}, {199645L: 1L}, {199807L: 4L}, {199808L: 7L}, {199809L: 3L}, {199810L: 5L}, {199811L: 7L}, {199833L: 5L}, {199839L: 1L}, {199842L: 1L}, {199848L: 6L}, {199851L: 9L}, {199912L: 12L}, {199933L: 1L}, {199934L: 8L}, {199940L: 5L}, {199941L: 1L}, {199942L: 4L}, {199945L: 1L}, {199948L: 3L}, {199949L: 27L}, {199950L: 41L}, {199951L: 26L}, {199952L: 12L}, {200001L: 41L}, {200002L: 42L}, {200003L: 47L}, {200004L: 42L}, {200005L: 31L}, {200006L: 62L}, {200007L: 50L}, {200008L: 38L}, {200009L: 33L}, {200010L: 61L}, {200011L: 52L}, {200012L: 16L}, {200013L: 24L}, {200014L: 44L}, {200015L: 75L}, {200016L: 97L}, {200017L: 96L}, {200018L: 107L}, {200019L: 134L}, {200020L: 115L}, {200021L: 138L}, {200022L: 178L}, {200023L: 155L}, {200024L: 91L}, {200025L: 77L}, {200026L: 89L}, {200027L: 81L}, {200028L: 133L}, {200029L: 81L}, {200030L: 130L}, {200031L: 141L}, {200032L: 142L}, {200033L: 88L}, {200034L: 104L}, {200035L: 169L}, {200036L: 221L}, {200037L: 216L}, {200038L: 155L}, {200039L: 133L}, {200040L: 178L}, {200041L: 236L}, {200042L: 188L}, {200043L: 192L}, {200044L: 213L}, {200045L: 267L}, {200046L: 143L}, {200047L: 59L}, {200048L: 99L}, {200049L: 113L}, {200050L: 146L}, {200051L: 90L}, {200052L: 24L}, {200053L: 113L}, {200101L: 130L}, {200102L: 151L}, {200103L: 219L}, {200104L: 127L}, {200105L: 98L}, {200106L: 140L}, {200107L: 239L}, {200108L: 252L}, {200109L: 235L}, {200110L: 76L}, {200111L: 53L}, {200112L: 94L}, {200113L: 111L}, {200114L: 57L}, {200115L: 80L}, {200116L: 83L}, {200117L: 189L}, {200118L: 86L}, {200119L: 21L}, {200120L: 10L}, {200121L: 53L}, {200122L: 152L}, {200123L: 126L}, {200124L: 3L}, {200125L: 12L}, {200126L: 45L}, {200127L: 15L}, {200128L: 28L}, {200129L: 29L}, {200130L: 91L}, {200131L: 82L}, {200132L: 126L}, {200133L: 179L}, {200134L: 80L}, {200135L: 45L}, {200136L: 15L}, {200137L: 13L}, {200138L: 12L}, {200139L: 115L}, {200140L: 34L}, {200141L: 11L}, {200142L: 12L}, {200143L: 90L}, {200144L: 112L}, {200145L: 91L}, {200146L: 29L}, {200147L: 75L}, {200148L: 130L}, {200149L: 122L}, {200150L: 55L}, {200151L: 17L}, {200152L: 113L}, {200201L: 95L}, {200202L: 122L}, {200203L: 129L}, {200204L: 139L}, {200205L: 131L}, {200206L: 120L}, {200207L: 135L}, {200208L: 158L}, {200209L: 223L}, {200210L: 189L}, {200211L: 197L}, {200212L: 59L}, {200213L: 128L}, {200214L: 109L}, {200215L: 108L}, {200216L: 216L}, {200217L: 196L}, {200218L: 139L}, {200219L: 157L}, {200220L: 200L}, {200221L: 256L}, {200222L: 380L}, {200223L: 350L}, {200224L: 395L}, {200225L: 453L}, {200226L: 316L}, {200227L: 364L}, {200228L: 240L}, {200229L: 254L}, {200230L: 271L}, {200231L: 227L}, {200232L: 289L}, {200233L: 261L}, {200234L: 224L}, {200235L: 270L}, {200236L: 178L}, {200237L: 174L}, {200238L: 118L}, {200239L: 134L}, {200240L: 160L}, {200241L: 230L}, {200242L: 303L}, {200243L: 302L}, {200244L: 325L}, {200245L: 266L}, {200246L: 245L}, {200247L: 244L}, {200248L: 225L}, {200249L: 195L}, {200250L: 185L}, {200251L: 124L}, {200252L: 207L}, {200301L: 349L}, {200302L: 399L}, {200303L: 348L}, {200304L: 189L}, {200305L: 236L}, {200306L: 188L}, {200307L: 216L}, {200308L: 220L}, {200309L: 205L}, {200310L: 234L}, {200311L: 233L}, {200312L: 161L}, {200313L: 251L}, {200314L: 148L}, {200315L: 142L}, {200316L: 203L}, {200317L: 145L}, {200318L: 228L}, {200319L: 189L}, {200320L: 117L}, {200321L: 141L}, {200322L: 186L}, {200323L: 338L}, {200324L: 114L}, {200325L: 167L}, {200326L: 239L}, {200327L: 186L}, {200328L: 128L}, {200329L: 114L}, {200330L: 131L}, {200331L: 195L}, {200332L: 175L}, {200333L: 153L}, {200334L: 190L}, {200335L: 165L}, {200336L: 113L}, {200337L: 481L}, {200338L: 304L}, {200339L: 228L}, {200340L: 149L}, {200341L: 244L}, {200342L: 166L}, {200343L: 295L}, {200344L: 177L}, {200345L: 297L}, {200346L: 294L}, {200347L: 423L}, {200348L: 286L}, {200349L: 327L}, {200350L: 226L}, {200351L: 260L}, {200352L: 234L}, {200401L: 320L}, {200402L: 304L}, {200403L: 288L}, {200404L: 311L}, {200405L: 306L}, {200406L: 401L}, {200407L: 366L}, {200408L: 245L}, {200409L: 319L}, {200410L: 272L}, {200411L: 200L}, {200412L: 339L}, {200413L: 252L}, {200414L: 348L}, {200415L: 327L}, {200416L: 270L}, {200417L: 174L}, {200418L: 243L}, {200419L: 335L}, {200420L: 263L}, {200421L: 199L}, {200422L: 213L}, {200423L: 195L}, {200424L: 115L}, {200425L: 116L}, {200426L: 148L}, {200427L: 703L}, {200428L: 225L}, {200429L: 297L}, {200430L: 219L}, {200431L: 229L}, {200432L: 220L}, {200433L: 243L}, {200434L: 243L}, {200435L: 249L}, {200436L: 234L}, {200437L: 520L}, {200438L: 195L}, {200439L: 284L}, {200440L: 301L}, {200441L: 251L}, {200442L: 429L}, {200443L: 282L}, {200444L: 328L}, {200445L: 188L}, {200446L: 215L}, {200447L: 207L}, {200448L: 217L}, {200449L: 197L}, {200450L: 229L}, {200451L: 182L}, {200452L: 127L}, {200501L: 416L}, {200502L: 359L}, {200503L: 304L}, {200504L: 506L}, {200505L: 553L}, {200506L: 401L}, {200507L: 288L}, {200508L: 302L}, {200509L: 314L}, {200510L: 237L}, {200511L: 260L}, {200512L: 242L}, {200513L: 251L}, {200514L: 294L}, {200515L: 258L}, {200516L: 265L}, {200517L: 265L}, {200518L: 305L}, {200519L: 565L}, {200520L: 485L}, {200521L: 411L}, {200522L: 327L}, {200523L: 406L}, {200524L: 278L}, {200525L: 301L}, {200526L: 143L}, {200527L: 251L}, {200528L: 614L}, {200529L: 321L}, {200530L: 361L}, {200531L: 382L}, {200532L: 253L}, {200533L: 220L}, {200534L: 322L}, {200535L: 383L}, {200536L: 252L}, {200537L: 270L}, {200538L: 141L}, {200539L: 241L}, {200540L: 267L}, {200541L: 194L}, {200542L: 199L}, {200543L: 150L}, {200544L: 117L}, {200545L: 156L}, {200546L: 238L}, {200547L: 128L}, {200548L: 224L}, {200549L: 132L}, {200550L: 191L}, {200551L: 265L}, {200552L: 473L}, {200601L: 187L}, {200602L: 248L}, {200603L: 152L}, {200604L: 153L}, {200605L: 198L}, {200606L: 192L}, {200607L: 207L}, {200608L: 203L}, {200609L: 274L}, {200610L: 142L}, {200611L: 238L}, {200612L: 264L}, {200613L: 170L}, {200614L: 227L}, {200615L: 196L}, {200616L: 129L}, {200617L: 204L}, {200618L: 166L}, {200619L: 155L}, {200620L: 182L}, {200621L: 142L}, {200622L: 114L}, {200623L: 87L}, {200624L: 143L}, {200625L: 115L}, {200626L: 144L}, {200627L: 152L}, {200628L: 107L}, {200629L: 148L}, {200630L: 186L}, {200631L: 153L}, {200632L: 206L}, {200633L: 190L}, {200634L: 146L}, {200635L: 187L}, {200636L: 229L}, {200637L: 257L}, {200638L: 245L}, {200639L: 300L}, {200640L: 501L}, {200641L: 480L}, {200642L: 799L}, {200643L: 1364L}, {200644L: 2609L}, {200645L: 1337L}, {200646L: 1355L}, {200647L: 1023L}, {200648L: 1095L}, {200649L: 1091L}, {200650L: 1337L}, {200651L: 1184L}, {200652L: 1193L}, {200653L: 1263L}, {200701L: 1007L}, {200702L: 1237L}, {200703L: 1008L}, {200704L: 851L}, {200705L: 1384L}, {200706L: 1071L}, {200707L: 1309L}, {200708L: 1029L}, {200709L: 1288L}, {200710L: 1163L}, {200711L: 1117L}, {200712L: 1259L}, {200713L: 925L}, {200714L: 1080L}, {200715L: 915L}, {200716L: 998L}, {200717L: 530L}, {200718L: 576L}, {200719L: 582L}, {200720L: 723L}, {200721L: 557L}, {200722L: 590L}, {200723L: 556L}, {200724L: 1322L}, {200725L: 1548L}, {200726L: 830L}, {200727L: 352L}, {200728L: 631L}, {200729L: 1090L}, {200730L: 712L}, {200731L: 789L}, {200732L: 398L}, {200733L: 740L}, {200734L: 329L}, {200735L: 691L}, {200736L: 973L}, {200737L: 485L}, {200738L: 697L}, {200739L: 1057L}, {200740L: 673L}, {200741L: 975L}, {200742L: 844L}, {200743L: 731L}, {200744L: 1613L}, {200745L: 1490L}, {200746L: 928L}, {200747L: 513L}, {200748L: 521L}, {200749L: 336L}, {200750L: 479L}, {200751L: 955L}, {200752L: 687L}, {200801L: 767L}, {200802L: 368L}, {200803L: 284L}, {200804L: 215L}, {200805L: 203L}, {200806L: 193L}, {200807L: 261L}, {200808L: 225L}, {200809L: 153L}, {200810L: 148L}, {200811L: 225L}, {200812L: 186L}, {200813L: 166L}, {200814L: 93L}, {200815L: 163L}, {200816L: 105L}, {200817L: 127L}, {200818L: 165L}, {200819L: 78L}, {200820L: 145L}, {200821L: 129L}, {200822L: 112L}, {200823L: 133L}, {200824L: 85L}, {200825L: 123L}, {200826L: 80L}, {200827L: 54L}, {200828L: 68L}, {200829L: 75L}, {200830L: 46L}, {200831L: 49L}, {200832L: 42L}, {200833L: 68L}, {200834L: 96L}, {200835L: 93L}, {200836L: 65L}, {200837L: 32L}]
    normalize(result,total)
if __name__ == "__main__":
    sys.exit(main())
